<!DOCTYPE HTML>
<html lang="es">
  <head>
    <title>Socket.io</title>
    <style type="text/css">
      .content{width:600px; height:400px; margin:100px auto 0 auto;}
      .content .square{float:left; width:100px; height:100px;}
      .content .red{background:#E20025}
      .content .green{background:#00D96D}
      .content .blue{background:#2693FF}
      .content .yellow{background:#FFFF4D}
      .content .gray{background:#BBBBBB}
      .content .purple{background:#A64DFF}

      #send{background:#CCC; padding:20px; width:50px;}

    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="http://localhost:8080/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        $(document).on('ready',iniciar);
        var websocket = io.connect('http://localhost:8080');
        var cont = 25;

        function iniciar(){
            websocket.on('mensajeServidor',recibirMensaje);
            $('.square').live('click',function(){
              $(this).addClass('clicked');
              $('#color').attr('val',getColor());
              enviarMensaje();
            });
        }

        function enviarMensaje(){
            var rel = $('.clicked').attr('id');
            var color = $('#color').attr('val');
            var obj = jQuery.parseJSON('{"relid":"'+rel+'","colorid":"'+color+'"}');
            websocket.emit('nuevoDato',obj);
        }

        function recibirMensaje(datosServidor){
            console.log(datosServidor.relid);
            console.log(datosServidor.colorid);
            $('#'+datosServidor.relid).remove();
            $('.content').append('<div id="'+(cont++)+'" class="square '+datosServidor.colorid+'"></div>');
        }

        function getColor(){
            var colors = []
                colors[1] = 'red';
                colors[2] = 'green';
                colors[3] = 'blue';
                colors[4] = 'yellow';
                colors[5] = 'gray';
                colors[6] = 'purple';

            var number = 1 + Math.floor(Math.random() * 6);
            
            return colors[number];
        }
    </script>
  </head>
  <body>
      <div class="content">
          <input id="color" type="hidden" val="">
          <div id="1" class="square red"></div>
          <div id="2" class="square green"></div>
          <div id="3" class="square blue"></div>
          <div id="4" class="square yellow"></div>
          <div id="5" class="square gray"></div>
          <div id="6" class="square purple"></div>
          <div id="7" class="square blue"></div>
          <div id="8" class="square yellow"></div>
          <div id="9" class="square gray"></div>
          <div id="10" class="square purple"></div>
          <div id="11" class="square red"></div>
          <div id="12" class="square green"></div>
          <div id="13" class="square purple"></div>
          <div id="14" class="square red"></div>
          <div id="15" class="square green"></div>
          <div id="16" class="square gray"></div>
          <div id="17" class="square purple"></div>
          <div id="18" class="square blue"></div>
          <div id="19" class="square gray"></div>
          <div id="20" class="square purple"></div>
          <div id="21" class="square blue"></div>
          <div id="22" class="square yellow"></div>
          <div id="23" class="square gray"></div>
          <div id="24" class="square purple"></div>
      </div>
      
  </body>
</html>